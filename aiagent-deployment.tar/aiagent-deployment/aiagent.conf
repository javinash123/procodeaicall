<VirtualHost *:80>
    ServerName 3.208.52.220
    ServerAdmin admin@example.com

    # Enable proxy modules
    ProxyPreserveHost On
    ProxyRequests Off

    # Route /aiagent/* to the Express app
    <Location /aiagent/>
        ProxyPass http://127.0.0.1:5000/
        ProxyPassReverse http://127.0.0.1:5000/
        
        # Headers for proxy
        RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s
        RequestHeader set X-Forwarded-Proto %{REQUEST_SCHEME}s
        RequestHeader set X-Forwarded-Host %{HTTP_HOST}s
        RequestHeader set X-Forwarded-Path /aiagent
    </Location>

    # Static files caching
    <Directory /home/ubuntu/aiagent/dist/public>
        Options -Indexes
        AllowOverride All
        Require all granted
        
        # Cache static assets for 1 year
        <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$">
            Header set Cache-Control "max-age=31536000, public"
        </FilesMatch>
        
        # No cache for HTML
        <FilesMatch "\.(html)$">
            Header set Cache-Control "no-cache, no-store, must-revalidate"
        </FilesMatch>
    </Directory>

    # Serve static files directly
    Alias /aiagent/assets /home/ubuntu/aiagent/dist/public/assets
    Alias /aiagent/uploads /home/ubuntu/aiagent/uploads

    # Log files
    ErrorLog ${APACHE_LOG_DIR}/aiagent_error.log
    CustomLog ${APACHE_LOG_DIR}/aiagent_access.log combined

    # Enable compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>
</VirtualHost>
