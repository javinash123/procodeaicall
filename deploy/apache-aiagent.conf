# Apache Configuration for NIJVOX AI Agent
# Add this to your Apache virtual host configuration or create a new site

# Enable required modules (run these commands if not already enabled):
# sudo a2enmod proxy
# sudo a2enmod proxy_http
# sudo a2enmod rewrite
# sudo a2enmod headers

<VirtualHost *:80>
    ServerName 3.208.52.220
    DocumentRoot /var/www/html

    # Alias for aiagent application
    Alias /aiagent /var/www/html/aiagent/public

    # Directory configuration for the React app
    <Directory /var/www/html/aiagent/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable mod_rewrite for SPA routing
        RewriteEngine On
        RewriteBase /aiagent/
        
        # If the requested file or directory doesn't exist, serve index.html
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /aiagent/index.html [L]
    </Directory>

    # Proxy API requests to Node.js backend on port 6331
    ProxyPreserveHost On
    
    # API endpoints
    ProxyPass /aiagent/api http://127.0.0.1:6331/api
    ProxyPassReverse /aiagent/api http://127.0.0.1:6331/api
    
    # Uploads endpoint
    ProxyPass /aiagent/uploads http://127.0.0.1:6331/uploads
    ProxyPassReverse /aiagent/uploads http://127.0.0.1:6331/uploads

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/aiagent-error.log
    CustomLog ${APACHE_LOG_DIR}/aiagent-access.log combined
</VirtualHost>
